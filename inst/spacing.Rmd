---
title: "Some thoughts on whitespace in R code"
author: "Robin Hankin"
date: "2025-08-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
<style>
  .col2 {
    columns: 2 200px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 200px; /* chrome, safari */
    -moz-columns: 2 200px;    /* firefox */
  }
  
  .col-break {
    break-before: column;       /* modern browsers */
    -webkit-column-break-before: always; /* Safari/Chrome */
    -moz-column-break-before: always;    /* Firefox */
  }
</style>

operators are tightly bound to their argument.<br><br>  </div>

When you are expressing mathematical ideas on paper, you want the
appearance of what you write to be easy to understand mathematically.
Conventional typesetting, and in particular TeX, does a very good job
of this.  This document discusses ways of making R expressions easy to
parse using monospaced font.  The tidyverse team states:

"All style guides are fundamentally opinionated"

Here, I put out some of my own opinions, but attempt to justify them.
Tidyverse lore is to include spaces pretty much everywhere: around
arithmetic operators, after commas, and around relations such as `=`
and `>=`.  Now I don't think this is optimal, at least for many of the
expressions I work with.  I present below several versions of an R
expression, arranged from least spaces to most spaces.  I show with a
tick or a cross whether or not that particular line passes the style
warning check in Rstudio.  In general, the tidyverse approved versions
are towards the end, as tidyverse people tend to put a lot of spaces
in their expressions.  Although I sometimes agree with the tidyverse
worldview, quite often below I will make a case for fewer spaces than
tidyverse.

I will start with the trivial case of unary operators:

<div class="col2"><p>
```
1: +1  ✅
2: + 1 ❌
```
</p><div class="col-break"></div><p>
Compare unary `+` with and without a space; tidyverse approves of
option 1 but not option 2.  This is correct IMO: unary 
operators are tightly bound to their argument.
<br><br></p></div>

TeX recognises this and typesets $+1$ differently from $1+1$.  It is
in fact quite difficult to convince TeX to typeset copy such as the
chess "win, draw, loss" notation [something like "$\mathord{+}3\
\mathord{=}4\ \mathord{-}5$", which would mean 3 wins, 4 draws and 5
losses.  The difficulty is persuading TeX to treat the equals sign and
the minus sign as unary operators].

For binary operators `*` and `/` we have slightly different rules
under RStudio:

<div class="col2">
```
1: 2*2   ✅
2: 2 * 2 ✅
```
</p><div class="col-break"></div><p>
I am equally happy with these in isolation.
<br><br></p></div>

[it is probably worth pointing out here that `2* 2` and `2 *2` draw
warnings about "inconsistent spacing"].  I have no preference here
either.
<br><br></div>

For something like `-a*b`, though, it doesn't matter whether we parse
this as `(-a)*b` or `-(a*b)`, for both are equivalent to `(-1)*a*b`
and associativity ensures that the two interpretations are identical.
This is not the case for powers, and the simplest example would be
`-1^2`.  This is parsed as `-(1^2)`:


```{r minusonesquared}
-1^2
```

This complicates the issue of spacing, at least if we are not going to
use parentheses:

```
1: -1^2    ✅
2: - 1^2   ❌
3: -1 ^ 2  ✅
4: - 1 ^ 2 ❌
```

Above, option 3 is definitely wrong.  I would actually go for option 2
here, as this makes it clear that that `1^2` is a unit.  The issue is
at least somewhat less ambiguous if we consider binary minus:

```
1: 1-2^2     ❌
2: 1 - 2^2   ✅
3: 1 - 2 ^ 2 ✅
```

Option 2 is the best here.  So what happens if we want to multiply a
positive number on the left by a negative number on the right?


```
1: 2*-3    ❌
2: 2 * -3  ✅
3: 2 * - 3 ❌
```

The minus sign is tightly bound to the 3 on the right, so option 2 is
the best, in agreement with RStudio.

```
1: 1+2*3     ❌
2: 1 + 2*3   ✅
3: 1 + 2 * 3 ✅
```

In passing, note that `1+2 * 3` is **definitely wrong**: as a general
rule, spacing around an operator should indicate low precedence for
that operator.  Maybe there should be a "cut-off" precedence? So only
operators below this cut-off value should have spaces.  Anyway,
standard recommendation is for option 3, having each operator
surrounded by spaces (but observe that option 2 draws no complaints
from the Rstudio IDE).  However, because the precedence of `*` is
higher than that of `+`, one generally parses `1+2*3` as `1 + (2*3)`,
so my preference would be 2. One wants the tightly-bound expression,
`2*3`, to be visually perceived as an isolated chunk that, although it
has some internal structure, is to be considered as a unit. This
echoes the use of radicals in chemistry; for example, methanol is
described as CH<sub>3</sub>OH [rather than, for example,
CH<sub>4</sub>O] because the OH radical often behaves as a discrete
and object that is difficult to split into an O and an H.  The fact
that it is actually composed of one atom of oxygen and one of hydrogen
is often irrelevant if not actively misleading.

```
1: 1+2*-3     ❌
2: 1 + 2 * -3 ✅
```

Above we see a preference for spaces which is technically OK but
frankly I would prefer brackets here and would plump for `1 + 2*(-3)`

```
1: 1+2*3^4       ❌
2: 1 + 2*3^4     ✅
3: 1 + 2 * 3^4   ✅
4: 1 + 2 * 3 ^ 4 ✅
```

Above, my preference would be option 3, as the `3^4` is the highest
priority.  However, it is entirely reasonably to view `2*3^4` as an
indivisible entity, and if so then option 2 would be the best.  If we
change the sign of the 4 then other issues arise:

```
1: 1+2*3^-4        ❌
2: 1 + 2*3^-4      ✅
3: 1 + 2 * 3^-4    ✅
4: 1 + 2 * 3 ^ -4  ✅
5: 1 + 2 * 3 ^ - 4 ❌
```

Above, we should be explicit that a unary operator does not require a
space after it (`+ 3` looks *terrible*; option 5 is an abomination).
Rstudio complains about options 1 and 5.  My favourite would be 3.
Now let's think about parentheses:


```
1: (1+2)*3     ❌
2: (1 + 2)*3   ✅
3: (1+2) * 3   ❌
4: (1 + 2) * 3 ✅
```

The whole point of parentheses is to subvert the standard arithmetic
rules of precedence.  If so, option 3 would be the best, as `1+2` is
the most tightly bound expression.  Options 2 and 4, having the space
around `+`, are poor because they distract from this.  I would go for
option 3 here, against RStudio's advice.


```
1: c(a=1,b=2)      ❌
2: c(a=1, b=2)     ❌
3: c(a=1 , b=2)    ❌
4: c(a = 1,b = 2)  ✅
4: c(a = 1, b = 2) ✅
```

Above we see, interestingly, that a space after a comma is not
required for RStudio approval.  I believe that the atoms of this
expression are `a=1` and `b=2` so there should be no space around the
equals sign.  I am split between options 2 and 3 on this one.

```
1: c(a=1,b=2+3i)   ❌
2: c(a=1, b=2)     ❌
3: c(a=1 , b=2)    ❌
4: c(a = 1,b = 2)  ✅
4: c(a = 1, b = 2) ✅
```




```
1: J(2.3+0.23i,use.theta=TRUE)
2: J(2.3+0.23i, use.theta=TRUE)
3: J(2.3 + 0.23i, use.theta = TRUE)
```

Above, I prefer version `2`.  I think that `2.3+0.23i` is a unit, and
`use.theta=TRUE` is a unit.


```
1:  seq(from=1+0.7i,to=-2+1i,len=20)
2:  seq(from=1+0.7i, to=-2+1i, len=20)
3:  seq(from = 1+0.7i, to = -2+1i, len=20)
4:  seq(from = 1+0.7i, to = -2+1i, len = 20)
5:  seq(from = 1 + 0.7i, to = -2 + 1i, len = 20)
```


```
1: as.primitive(c(3+5i,2+3i))
2: as.primitive(c(3+5i, 2+3i))
3: as.primitive(c(3 + 5i, 2 + 3i))
```

Above, I prefer "2:"


```
-as.primitive(c(3+5i,2+3i),n=5)
+as.primitive(c(3+5i, 2+3i))
+as.primitive(c(3+5i, 2+3i), n = 5)
 
 ##Rounding error:
-is.primitive(c(1,1i))
+is.primitive(c(1, 1i))
 
 ## Try
- is.primitive(c(1,1.001i))
+ is.primitive(c(1, 1.001i))
```
